<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
<link rel='stylesheet' href='common.css'>
<script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<style>
article {
	position: relative;
	transition: left 0.5s;
	white-space: nowrap;
}
body {
	overflow-x: hidden;
}
section {
	box-sizing: border-box;
	color: #333;
	display: inline-block;
	padding: 2em;
	width: 100%;
}
section a {
	background: #eee;
	border-radius: 0.6em;
	box-shadow: 0 0.3em #ddd;
	color: #333;
	display: block;
	line-height: 2;
	margin-top: 1.5em;
	position: relative;
	text-align: center;
	transition: all 0.5s;
}
section a:after {
	left: 1em;
	position: absolute;
}
a.wrong {
	background: hsl(15, 100%, 40%);
	box-shadow: 0 0.3em hsl(15, 100%, 30%);
	color: #fff;
}
a.right {
	background: hsl(135, 100%, 40%);
	box-shadow: 0 0.3em hsl(135, 100%, 30%);
	color: #fff;
}
a.right:after {
	content: '\2714';
}
a.wrong:after {
	content: '\2718';
}
.result {
	font-size: 150%;
	text-align: center;
}
</style>
<script id='questions' type='text/plain'>
I come [at/=from/in/to] England.
Don't go out [as/while/=until] you've finished your work.
I have been [play/played/=playing/plays] since the morning.
I fly to Austria [=every winter/last winter/next winter].
</script>
</head>
<body>
<header><a class='back' href='javascript:window.history.back()'></a>Grammar Test</header>
<!--
<i class='fl-lt icon-left-open' onclick='scroll(-1)'></i>
<i class='fl-rt icon-right-open' onclick='scroll(1)'></i>
-->
<article style='left:0'></article>
<script>
function $$(s) {
	return document.querySelector(s);
}
$(document).on('click', 'section a', function(e) {
	var a = e.target, b, s;
	if (a.className) return;
	b = a.hasAttribute('right');
	a.className = b ? 'right' : 'wrong';
	s = a.parentElement;
	if (!s.className) s.className = a.className;
	if (b) {
		setTimeout(function() {
			container.style.left = -count + '00%';
			next();
		}, 1000);
	}
/*
var x0;
function scroll(direction) {
	container.style.left = parseInt(container.style.left) + direction * 100 + '%';
	x0 = 0;
}
}).on('mousedown', function(e) {
	x0 = e.screenX;
}).on('mousemove', function(e) {
	if (!x0) return;
	var dx = e.screenX - x0;
	if (dx < 80)
		scrollToX(-1);
	else if (dx > 80)
		scrollToX(1);
*/
});
var body = document.body, container = $$('article'), questions = $$('#questions').textContent.split(/[\n\r]+/), count = 0;
function next() {
	if (!questions) return;
	var q;
	while (questions.length) {
		if (q = questions.shift()) {
			container.appendChild(makeCard(q));
			return;
		}
	}
	questions = false;
	var percent = $('section.right').length / $('section').length, s = document.createElement('section');
	s.className = 'result';
	s.innerHTML = 'Your score: ' + percent * 100 + '%';
	container.appendChild(s);
}
function makeCard(question) {
	count++;
	var i = question.indexOf('['), j = question.indexOf(']', i);
	question.substring(i + 1, j).split('/').forEach(function(choice) {
		if (choice[0] == '=')
			question += '<a right>' + choice.substring(1) + '</a>';
		else
			question += '<a>' + choice + '</a>';
	});
	var s = document.createElement('section');
	s.innerHTML = question.substring(0, i) + '____' + question.substring(j + 1);
	return s;
//	q.replace(/\[([^/\]]+)\]/g, '<input value="$1">'));
}
next();
</script>
</body>
</html>
