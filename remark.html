<html>
<head>
<script src="zepto.min.js"></script>
</head>
<body>
<script type='remark'>
It is a good day to die.
I don't agree.

Why?
x|y|z
u|v
Hmm
</script>
<script>
function forEach(list, callback) {
	var i, l;
	if (list) {
		for (i = 0, l = list.length; i < l; i++) {
			callback(list[i], i, list);
		}
	}
}
function requireParent(parent, tagName) {
	if (parent.tagName === tagName)
		return parent;
	if (parent.parentNode)
		parent = parent.parentNode;
	return createElement(parent, tagName);
}
function createElement(parent, tagName) {
	var e = document.createElement(tagName);
	parent.appendChild(e);
	return e;
}
function createText(parent, text) {
	var t = document.createTextNode(text);
	parent.appendChild(t);
	return t;
}
var parent;
function render(text) {
	parent = document.createElement('article');
	text.split(/\n\r|\n|\r/).forEach(function(line) {
		blocks.some(function(regexp) {
			var m = regexp.exec(line);
			if (m) regexp.handle(m);
			return m;
		});
	});
	return parent;
}
var parent;
function render(text) {
	parent = document.createElement('article');
	text.split(/\n\r|\n|\r/).forEach(function(line) {
		blocks.some(function(regexp) {
			var m = regexp.exec(line);
			if (m) regexp.handle(m);
			return m;
		});
	});
	return parent;
}
var blocks = [], inlines = [];
blocks.add = inlines.add = function(regexp, handler) {
	regexp.handle = handler;
	this.push(regexp);
	return this;
};
blocks.add(/$(.+)/, function(m) {
		createText(requireParent(parent, 'HEADER'), m[1]);
});
blocks.add(/\|/, function(m) {
	parent = requireParent(parent, 'TABLE');
	var tr = createElement(parent, 'TR');
	m.input.split('|').forEach(function(data) {
		var td = createElement(tr, 'TD');
		createText(td, data);
	});
});
blocks.add(/.*/, function(m) {
	if (m.input.length) {
		parent = requireParent(parent, 'P');
		if (parent.hasChildNodes())
			createElement(parent, 'BR');
		createText(parent, m.input);
	} else {
		if (parent.parentNode)
			parent = parent.parentNode;
	}
});
/*
forEach(document.querySelectorAll('script[type="remark"]'), function(script) {
	parent = document.createElement('article');
	script.text.split(/\n\r|\n|\r/).forEach(function(line) {
		blocks.some(function(regexp) {
			var m = regexp.exec(line);
			if (m) regexp.handle(m);
			return m;
		});
	});
	script.parentNode.replaceChild(parent, script);
});
*/
$.get(location.search.substring(1) + '.rem', function(result) {
	document.body.appendChild(render(result));
});
</script>
</body>
</html>
